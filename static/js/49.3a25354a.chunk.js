"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[49],{8049:(e,t,i)=>{i.r(t),i.d(t,{default:()=>$});var l=i(5043),n=i(1390),r=i(6446),o=i(1637),s=i(8911),a=i(7392),d=i(2557),c=i(3875),u=i(5874),h=i(3216),v=i(5865),m=i(6178),x=i.n(m),p=i(141),g=i(7798),f=i(579);const j=(e,t)=>{switch(e){case"video":case"audio":return(0,f.jsx)("video",{src:t,preload:"none",width:"200px",controls:!0});case"image":return(0,f.jsx)("img",{src:(0,p.ay)(t,200),alt:"Attachment",width:"200px",height:"150px",style:{objectFit:"contain"}});default:return(0,f.jsx)(g.A,{})}};var A=i(3003),y=i(6900);const b=e=>{let{message:t,user:i,groupChat:l}=e;const{sender:n,content:o,attachments:s=[],createdAt:a}=t,d=(null===n||void 0===n?void 0:n._id)===(null===i||void 0===i?void 0:i._id),{theme:c}=(0,A.d4)((e=>e.chat)),u=x()(a).format("h:mm A YYYY");return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(y.P.div,{initial:{opacity:0,x:"-100%"},whileInView:{opacity:1,x:0},style:{alignSelf:d?"flex-end":"flex-start",width:"fit-content"},children:[(0,f.jsxs)("div",{style:{backgroundColor:d&&0===s.length?c:"rgb(238, 238, 238)",borderRadius:d?"15px 15px 0px 15px":"15px 15px 15px 0px",padding:"0.5rem",color:d&&0===s.length?"white":"black",overflow:"auto"},children:[!d&&l&&(0,f.jsx)(v.A,{color:c,fontWeight:"600",variant:"caption",children:n.name}),o&&(0,f.jsx)(v.A,{children:o}),s.length>0&&s.map(((e,t)=>{const i=e.url,l=(0,p.IR)(i);return(0,f.jsx)(r.A,{children:(0,f.jsx)("a",{href:i,target:"_blank",download:!0,style:{color:"black"},children:j(l,i)})},t)}))]}),(0,f.jsx)(v.A,{variant:"caption",color:"text.secondary",style:{alignSelf:d?"flex-end":"",width:"fit-content"},children:u})]})})},k=(0,l.memo)(b);var C=i(7832),w=i(4852),I=i(7025),S=i(3202),E=i(5948),R=i(2369),_=i(2581),L=i(2167),D=i(9379),F=i(4302),G=i(5079),Y=i(8082);const O=e=>{var t,i;let{socket:n,chatMemberDetails:o,handleDeleteChat:s}=e;const c=(0,h.Zp)(),u=(0,h.g)(),m=null===u||void 0===u?void 0:u.id,[x,p]=(0,l.useState)(!1),g=(0,l.useCallback)((e=>{var t;const i=null===e||void 0===e?void 0:e.includes(null===o||void 0===o||null===(t=o.chatAvatar[0])||void 0===t?void 0:t._id);p(!!i)}),[]),j={[I.nF]:g};(0,E.Q7)(n,j);return(0,f.jsxs)(r.A,{sx:{display:"flex",backgroundColor:d.ON,borderRadius:"15px",padding:"5px",position:"sticky",top:"auto",zIndex:100},margin:"5px",children:[(0,f.jsx)(L.A,{title:"back",children:(0,f.jsx)(a.A,{sx:{color:"black"},onClick:()=>c("/"),children:(0,f.jsx)(F.A,{})})}),null!==o&&void 0!==o&&o.chatAvatar?(0,f.jsx)(G.A,{avatar:null===o||void 0===o?void 0:o.chatAvatar}):(0,f.jsx)(D.A,{}),(0,f.jsxs)(r.A,{sx:{marginLeft:{xs:"0.5rem",sm:"1rem"}},children:[(0,f.jsx)(v.A,{variant:"h5",children:null===o||void 0===o?void 0:o.chatName}),null!==o&&void 0!==o&&o.isGroupChat?(0,f.jsx)(L.A,{title:"You, ".concat(null===o||void 0===o||null===(t=o.chatAvatar)||void 0===t?void 0:t.map((e=>e.name)).join(",")),children:(0,f.jsx)(v.A,{sx:{color:"gray",fontSize:"0.85rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:{xs:"60%",md:"100%"}},children:"You, ".concat(null===o||void 0===o||null===(i=o.chatAvatar)||void 0===i?void 0:i.map((e=>e.name)).join(","))})}):x&&(0,f.jsx)(v.A,{sx:{fontSize:"0.85rem",color:"green",opacity:x?1:0,transition:"opacity 1s ease-in"},children:"online"})]}),(0,f.jsx)(a.A,{sx:{position:"absolute",right:"0",color:"black"},onClick:e=>s(e,m,null===o||void 0===o?void 0:o.isGroupChat),children:(0,f.jsx)(Y.A,{})})]})},T=(0,l.memo)(O);var z=i(3355),V=i(2437),M=i(922),N=i(6990),Z=i(8734),H=i(7856),q=i(3654),B=i(3859),J=i(9931),P=i(3768);const Q=e=>{let{anchorE1:t,chatId:i}=e;const{isFileMenu:n}=(0,A.d4)((e=>e.misc)),r=(0,A.wA)(),o=(0,l.useRef)(null),s=(0,l.useRef)(null),a=(0,l.useRef)(null),d=(0,l.useRef)(null),[c]=(0,S.zO)(),u=()=>{r((0,z.e5)(!1))},h=async(e,t)=>{const l=Array.from(e.target.files);if(l.length<=0)return;if(l.length>2)return P.Ay.error("You can only send two ".concat(t," at a time."));r((0,z.Z6)(!0));const n=P.Ay.loading("Sending ".concat(t));u();try{const e=new FormData;e.append("chatId",i),l.forEach((t=>e.append("files",t)));const r=await c(e);var o,s,a,d;if(r.data)P.Ay.success("".concat(t," sent successfully"),{id:n});else null!==r&&void 0!==r&&null!==(o=r.error)&&void 0!==o&&null!==(s=o.data)&&void 0!==s&&s.message?P.Ay.error(null===r||void 0===r||null===(a=r.error)||void 0===a||null===(d=a.data)||void 0===d?void 0:d.message,{id:n}):P.Ay.error("Failed to send ".concat(t),{id:n})}catch(h){P.Ay.error(h,{id:n})}finally{r((0,z.Z6)(!1))}};return(0,f.jsx)(V.A,{anchorEl:t,open:n,onClose:u,children:(0,f.jsx)("div",{style:{width:"10rem"},children:(0,f.jsxs)(M.A,{children:[(0,f.jsxs)(N.A,{onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},children:[(0,f.jsx)(L.A,{title:"Image",children:(0,f.jsx)(H.A,{})}),(0,f.jsx)(Z.A,{style:{marginLeft:"0.5rem"},children:"Image"}),(0,f.jsx)("input",{ref:o,type:"file",multiple:!0,accept:"image/png, image/jpeg, image/gif",style:{display:"none"},onChange:e=>h(e,"Images")})]}),(0,f.jsxs)(N.A,{onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},children:[(0,f.jsx)(L.A,{title:"Audio",children:(0,f.jsx)(q.A,{})}),(0,f.jsx)(Z.A,{style:{marginLeft:"0.5rem"},children:"Audio"}),(0,f.jsx)("input",{ref:a,type:"file",multiple:!0,accept:"audio/mpeg, audio/wav",style:{display:"none"},onChange:e=>h(e,"Audios")})]}),(0,f.jsxs)(N.A,{onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},children:[(0,f.jsx)(L.A,{title:"Video",children:(0,f.jsx)(B.A,{})}),(0,f.jsx)(Z.A,{style:{marginLeft:"0.5rem"},children:"Video"}),(0,f.jsx)("input",{type:"file",ref:s,multiple:!0,accept:"video/mp4, video/webm, video/ogg",style:{display:"none"},onChange:e=>h(e,"Videos")})]}),(0,f.jsxs)(N.A,{onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},children:[(0,f.jsx)(L.A,{title:"File",children:(0,f.jsx)(J.A,{})}),(0,f.jsx)(Z.A,{style:{marginLeft:"0.5rem"},children:"File"}),(0,f.jsx)("input",{type:"file",ref:d,multiple:!0,accept:"*",style:{display:"none"},onChange:e=>h(e,"Files")})]})]})})})},$=(0,n.A)()((e=>{var t,i;let{chatId:n,user:v,chats:m=[],handleDeleteChat:x}=e;(0,h.Zp)();const[p,g]=(0,l.useState)(""),[j,y]=(0,l.useState)(1),[b,L]=(0,l.useState)(0),[D,F]=(0,l.useState)(""),G=(0,l.useRef)(null),Y=(0,l.useRef)(null),O=(0,l.useRef)(null),[V,M]=(0,l.useState)([]),[N,Z]=(0,l.useState)(""),[H,q]=(0,l.useState)(!1),[B,J]=(0,l.useState)(null),P=(0,w.Y)(),$=(0,A.wA)(),W=(0,S.eo)({chatId:n,skip:!n}),X=null===W||void 0===W||null===(t=W.data)||void 0===t||null===(i=t.chat)||void 0===i?void 0:i.members,{data:K,isLoading:U}=(0,S.uw)({chatId:n,page:j}),{data:ee}=(0,S.y1)({chatId:n}),{theme:te}=(0,A.d4)((e=>e.chat)),ie=[{isError:W.isError,error:W.error}];(0,l.useEffect)((()=>(P.emit(I.Jw,{userId:null===v||void 0===v?void 0:v._id,members:X}),$((0,_.nx)(n)),()=>{M([]),g(""),y(1),L(0)})),[n]),(0,l.useEffect)((()=>{G.current&&1===j&&G.current.scrollIntoView({behaviour:"smooth"})}),[V]),(0,l.useEffect)((()=>{K&&(L(null===K||void 0===K?void 0:K.totalPages),M(K?[...K.messages,...V]:[...V]))}),[K]),(0,l.useEffect)((()=>{const e=()=>{if(0===O.current.scrollTop){if(j===b)return void y(b);y((e=>e+1))}},t=O.current;return t.addEventListener("scroll",e),()=>{t.removeEventListener("scroll",e)}}),[b,j]);const le=(0,l.useCallback)((e=>{e.chatId===n&&M((t=>[...t,null===e||void 0===e?void 0:e.message]))}),[n]),ne=(0,l.useCallback)((e=>{e.chatId===n&&Z(!0)}),[n]),re=(0,l.useCallback)((e=>{e.chatId===n&&Z(!1)}),[n]),oe=(0,l.useCallback)((e=>{if(e.chatId!==n)return;const t={content:e.message,sender:{_id:"jaflkjlfakjlkdajljf",name:"Admin"},chat:n,createdAt:(new Date).toISOString()};M((e=>[...e,t]))}),[n]),se={[I.J8]:oe,[I.tq]:le,[I.v_]:ne,[I.$H]:re,[I.o9]:e=>{let{userId:t,username:i,chatId:l}=e;n===l&&null!==ee&&void 0!==ee&&ee.isGroupChat&&F(i)},[I._b]:()=>{null!==ee&&void 0!==ee&&ee.isGroupChat&&F()}};(0,E.Q7)(P,se),(0,E.xB)(ie);return(0,f.jsxs)(r.A,{sx:{display:"flex",position:"relative",flexDirection:"column",borderBottom:"1px solid black",width:{xs:"100%",sm:"70%"},height:"100vh"},children:[(0,f.jsx)(T,{socket:P,chatMemberDetails:ee,handleDeleteChat:x}),U&&(0,f.jsx)(r.A,{alignItems:"center",children:(0,f.jsx)(o.A,{})}),(0,f.jsxs)(s.A,{ref:O,boxSizing:"border-box",spacing:"1rem",padding:"1rem",bgcolor:d.ON,height:"100%",sx:{position:"relative",overflowX:"hidden",overflowY:"scroll",borderRadius:"20px"},children:[null===V||void 0===V?void 0:V.map((e=>(0,f.jsx)(k,{message:e,user:v,groupChat:null===ee||void 0===ee?void 0:ee.isGroupChat},e._id))),N&&!(null!==ee&&void 0!==ee&&ee.isGroupChat)&&(0,f.jsx)(R.L,{}),(null===ee||void 0===ee?void 0:ee.isGroupChat)&&D&&(0,f.jsxs)("div",{style:{color:"green"},children:[D," is typing..."]}),(0,f.jsx)("div",{ref:G})]}),(0,f.jsx)("form",{style:{position:"sticky",bottom:0,marginTop:"10px"},onSubmit:e=>{e.preventDefault(),p.trim()&&(P.emit(I.tq,{chatId:n,members:X,message:p}),g(""))},children:(0,f.jsxs)(s.A,{direction:"row",height:"100%",padding:"1rem",alignItems:"center",position:"relative",sx:{backgroundColor:d.ON,borderRadius:"15px"},children:[(0,f.jsx)(a.A,{sx:{position:"absolute",left:"1.5rem",rotate:"30deg",color:"black"},onClick:e=>{$((0,z.e5)(!0)),J(e.currentTarget)},children:(0,f.jsx)(c.A,{})}),(0,f.jsx)(C.cl,{placeholder:"Type Message Here...",value:p,onChange:e=>{g(e.target.value),H||(null!==ee&&void 0!==ee&&ee.isGroupChat&&P.emit(I.o9,{userId:v._id,username:v.name,chatId:n}),q(!0)),P.emit(I.v_,{members:X,chatId:n}),Y.current&&clearTimeout(Y.current),Y.current=setTimeout((()=>{null!==ee&&void 0!==ee&&ee.isGroupChat&&P.emit(I._b),P.emit(I.$H,{members:X,chatId:n}),q(!1)}),1500)}}),(0,f.jsx)(a.A,{type:"submit",sx:{bgcolor:d.wm,rotate:"-30deg",color:te,marginLeft:"1rem",padding:"0.5rem"},children:(0,f.jsx)(u.A,{})})]})}),(0,f.jsx)(Q,{anchorE1:B,chatId:n})]})}))}}]);
//# sourceMappingURL=49.3a25354a.chunk.js.map