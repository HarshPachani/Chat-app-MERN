"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[49],{8049:(e,t,i)=>{i.r(t),i.d(t,{default:()=>$});var l=i(5043),n=i(1390),r=i(6446),o=i(8911),s=i(1637),a=i(7392),d=i(2557),c=i(3875),u=i(5874),h=i(5865),m=i(6178),v=i.n(m),x=i(141),p=i(7798),g=i(579);const f=(e,t)=>{switch(e){case"video":case"audio":return(0,g.jsx)("video",{src:t,preload:"none",width:"200px",controls:!0});case"image":return(0,g.jsx)("img",{src:(0,x.ay)(t,200),alt:"Attachment",width:"200px",height:"150px",style:{objectFit:"contain"}});default:return(0,g.jsx)(p.A,{})}};var j=i(3003),A=i(6900);const y=e=>{let{message:t,user:i,groupChat:l}=e;const{sender:n,content:o,attachments:s=[],createdAt:a}=t,d=(null===n||void 0===n?void 0:n._id)===(null===i||void 0===i?void 0:i._id),{theme:c}=(0,j.d4)((e=>e.chat)),u=v()(a).format("DD-MM-YYYY hh:mm A");return(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)(A.P.div,{initial:{opacity:0,x:"-100%"},whileInView:{opacity:1,x:0},style:{alignSelf:d?"flex-end":"flex-start",width:"fit-content"},children:[(0,g.jsxs)("div",{style:{backgroundColor:d&&0===s.length?c:"rgb(238, 238, 238)",borderRadius:d?"15px 15px 0px 15px":"15px 15px 15px 0px",padding:"0.5rem",color:d&&0===s.length?"white":"black",overflow:"auto"},children:[!d&&l&&(0,g.jsx)(h.A,{color:c,fontWeight:"600",variant:"caption",children:n.name}),o&&(0,g.jsx)(h.A,{children:o}),s.length>0&&s.map(((e,t)=>{const i=e.url,l=(0,x.IR)(i);return(0,g.jsx)(r.A,{children:(0,g.jsx)("a",{href:i,target:"_blank",download:!0,style:{color:"black"},children:f(l,i)})},t)}))]}),(0,g.jsx)(h.A,{variant:"caption",color:"text.secondary",style:{alignSelf:d?"flex-end":"",width:"fit-content"},children:u})]})})},b=(0,l.memo)(y);var k=i(7832),C=i(4852),w=i(7025),I=i(3202),S=i(5948),E=i(2369),R=i(2581),_=i(2167),D=i(9379),F=i(3216),L=i(4302),G=i(5079),Y=i(8082);const M=e=>{var t,i;let{socket:n,chatMemberDetails:o,handleDeleteChat:s}=e;const c=(0,F.Zp)(),u=(0,F.g)(),m=null===u||void 0===u?void 0:u.id,[v,x]=(0,l.useState)(!1),[p,f]=(0,l.useState)([]),j=(0,l.useCallback)((e=>{f(e)}),[o]);(0,l.useEffect)((()=>{if(o){var e,t;const i=null===o||void 0===o||null===(e=o.chatAvatar)||void 0===e||null===(t=e[0])||void 0===t?void 0:t._id,l=p.includes(i);x(l)}}),[o,p]);const A={[w.nF]:j};(0,l.useEffect)((()=>{n.emit(w.nF,{})}),[]),(0,S.Q7)(n,A);return(0,g.jsxs)(r.A,{sx:{display:"flex",backgroundColor:d.ON,borderRadius:"15px",padding:"5px",position:"sticky",top:"auto",zIndex:100},margin:"5px",children:[(0,g.jsx)(_.A,{title:"back",children:(0,g.jsx)(a.A,{sx:{color:"black"},onClick:()=>c("/Chat-app-MERN"),children:(0,g.jsx)(L.A,{})})}),null!==o&&void 0!==o&&o.chatAvatar?(0,g.jsx)(G.A,{avatar:null===o||void 0===o?void 0:o.chatAvatar}):(0,g.jsx)(D.A,{}),(0,g.jsxs)(r.A,{sx:{marginLeft:{xs:"0.5rem",sm:"1rem"}},children:[(0,g.jsx)(h.A,{variant:"h5",children:null===o||void 0===o?void 0:o.chatName}),null!==o&&void 0!==o&&o.isGroupChat?(0,g.jsx)(_.A,{title:"You, ".concat(null===o||void 0===o||null===(t=o.chatAvatar)||void 0===t?void 0:t.map((e=>e.name)).join(",")),children:(0,g.jsx)(h.A,{sx:{color:"gray",fontSize:"0.85rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:{xs:"60%",md:"100%"}},children:"You, ".concat(null===o||void 0===o||null===(i=o.chatAvatar)||void 0===i?void 0:i.map((e=>e.name)).join(","))})}):v&&(0,g.jsx)(h.A,{sx:{fontSize:"0.85rem",color:"green",opacity:v?1:0,transition:"opacity 1s ease-in"},children:"online"})]}),(0,g.jsx)(a.A,{sx:{position:"absolute",right:"0",color:"black"},onClick:e=>s(e,m,null===o||void 0===o?void 0:o.isGroupChat),children:(0,g.jsx)(Y.A,{})})]})},V=(0,l.memo)(M);var O=i(3355),T=i(2437),z=i(922),N=i(6990),H=i(8734),Z=i(7856),q=i(3654),B=i(3859),J=i(9931),P=i(3768);const Q=e=>{let{anchorE1:t,chatId:i}=e;const{isFileMenu:n}=(0,j.d4)((e=>e.misc)),r=(0,j.wA)(),o=(0,l.useRef)(null),s=(0,l.useRef)(null),a=(0,l.useRef)(null),d=(0,l.useRef)(null),[c]=(0,I.zO)(),u=()=>{r((0,O.e5)(!1))},h=async(e,t)=>{const l=Array.from(e.target.files);if(l.length<=0)return;if(l.length>2)return P.Ay.error("You can only send two ".concat(t," at a time."));r((0,O.Z6)(!0));const n=P.Ay.loading("Sending ".concat(t));u();try{const e=new FormData;e.append("chatId",i),l.forEach((t=>e.append("files",t)));const r=await c(e);var o,s,a,d;if(r.data)P.Ay.success("".concat(t," sent successfully"),{id:n});else null!==r&&void 0!==r&&null!==(o=r.error)&&void 0!==o&&null!==(s=o.data)&&void 0!==s&&s.message?P.Ay.error(null===r||void 0===r||null===(a=r.error)||void 0===a||null===(d=a.data)||void 0===d?void 0:d.message,{id:n}):P.Ay.error("Failed to send ".concat(t),{id:n})}catch(h){P.Ay.error(h,{id:n})}finally{r((0,O.Z6)(!1))}};return(0,g.jsx)(T.A,{anchorEl:t,open:n,onClose:u,children:(0,g.jsx)("div",{style:{width:"10rem"},children:(0,g.jsxs)(z.A,{children:[(0,g.jsxs)(N.A,{onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},children:[(0,g.jsx)(_.A,{title:"Image",children:(0,g.jsx)(Z.A,{})}),(0,g.jsx)(H.A,{style:{marginLeft:"0.5rem"},children:"Image"}),(0,g.jsx)("input",{ref:o,type:"file",multiple:!0,accept:"image/png, image/jpeg, image/gif",style:{display:"none"},onChange:e=>h(e,"Images")})]}),(0,g.jsxs)(N.A,{onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},children:[(0,g.jsx)(_.A,{title:"Audio",children:(0,g.jsx)(q.A,{})}),(0,g.jsx)(H.A,{style:{marginLeft:"0.5rem"},children:"Audio"}),(0,g.jsx)("input",{ref:a,type:"file",multiple:!0,accept:"audio/mpeg, audio/wav",style:{display:"none"},onChange:e=>h(e,"Audios")})]}),(0,g.jsxs)(N.A,{onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},children:[(0,g.jsx)(_.A,{title:"Video",children:(0,g.jsx)(B.A,{})}),(0,g.jsx)(H.A,{style:{marginLeft:"0.5rem"},children:"Video"}),(0,g.jsx)("input",{type:"file",ref:s,multiple:!0,accept:"video/mp4, video/webm, video/ogg",style:{display:"none"},onChange:e=>h(e,"Videos")})]}),(0,g.jsxs)(N.A,{onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},children:[(0,g.jsx)(_.A,{title:"File",children:(0,g.jsx)(J.A,{})}),(0,g.jsx)(H.A,{style:{marginLeft:"0.5rem"},children:"File"}),(0,g.jsx)("input",{type:"file",ref:d,multiple:!0,accept:"*",style:{display:"none"},onChange:e=>h(e,"Files")})]})]})})})},$=(0,n.A)()((e=>{var t,i;let{chatId:n,user:h,handleDeleteChat:m}=e;const[v,x]=(0,l.useState)(""),[p,f]=(0,l.useState)(1),[A,y]=(0,l.useState)(0),[_,D]=(0,l.useState)(0),[F,L]=(0,l.useState)(""),[G,Y]=(0,l.useState)([]),[M,T]=(0,l.useState)(""),[z,N]=(0,l.useState)(!1),[H,Z]=(0,l.useState)(null),[q,B]=(0,l.useState)(!0),J=(0,l.useRef)(null),P=(0,l.useRef)(null),$=(0,l.useRef)(null),W=(0,l.useRef)(null),X=(0,C.Y)(),K=(0,j.wA)(),U=(0,I.eo)({chatId:n,skip:!n}),ee=null===U||void 0===U||null===(t=U.data)||void 0===t||null===(i=t.chat)||void 0===i?void 0:i.members,{data:te,isLoading:ie}=(0,I.uw)({chatId:n,page:p,totalMessages:null===G||void 0===G?void 0:G.length},{skip:!q}),{data:le}=(0,I.y1)({chatId:n}),{theme:ne}=(0,j.d4)((e=>e.chat)),re=[{isError:U.isError,error:U.error}];(0,l.useEffect)((()=>(X.emit(w.Jw,{userId:null===h||void 0===h?void 0:h._id,members:ee}),K((0,R.nx)(n)),()=>{Y([]),x(""),f(1),D(0),B(!0)})),[n]),(0,l.useEffect)((()=>{J.current&&1===p&&J.current.scrollIntoView({behaviour:"smooth"})}),[G]),(0,l.useEffect)((()=>{te&&(D(null===te||void 0===te?void 0:te.totalPages),Y(null!==te&&void 0!==te&&te.messages?[...te.messages,...G]:[]),B(!1))}),[te]),(0,l.useEffect)((()=>{const e=()=>{if(0===$.current.scrollTop){if(p===_)return void f(_);f((e=>e+1)),q||B(!0)}},t=$.current;return t.addEventListener("scroll",e),()=>{t.removeEventListener("scroll",e)}}),[_,p,q]);const oe=(0,l.useCallback)((e=>{e.chatId===n&&(y((e=>e+1)),Y((t=>[...t,null===e||void 0===e?void 0:e.message])),J.current.scrollIntoView({behaviour:"smooth"}))}),[n]),se=(0,l.useCallback)((e=>{e.chatId===n&&T(!0)}),[n]),ae=(0,l.useCallback)((e=>{e.chatId===n&&T(!1)}),[n]),de=(0,l.useCallback)((e=>{if(e.chatId!==n)return;const t={content:e.message,sender:{_id:"jaflkjlfakjlkdajljf",name:"Admin"},chat:n,createdAt:(new Date).toISOString()};Y((e=>[...e,t]))}),[n]),ce={[w.J8]:de,[w.tq]:oe,[w.v_]:se,[w.$H]:ae,[w.o9]:e=>{let{userId:t,username:i,chatId:l}=e;n===l&&null!==le&&void 0!==le&&le.isGroupChat&&L(i)},[w._b]:()=>{null!==le&&void 0!==le&&le.isGroupChat&&L()}};(0,S.Q7)(X,ce),(0,S.xB)(re);return(0,g.jsxs)(r.A,{sx:{display:"flex",position:"relative",flexDirection:"column",borderBottom:"1px solid black",width:{xs:"100%",sm:"70%"},height:"100vh"},children:[(0,g.jsx)(V,{socket:X,chatMemberDetails:le,handleDeleteChat:m}),(0,g.jsx)(o.A,{ref:$,boxSizing:"border-box",spacing:"1rem",padding:"1rem",bgcolor:d.ON,height:"100%",sx:{position:"relative",overflowX:"hidden",overflowY:"scroll",borderRadius:"20px"},children:ie?(0,g.jsx)(r.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,g.jsx)(s.A,{sx:{color:ne}})}):(0,g.jsxs)(g.Fragment,{children:[null===G||void 0===G?void 0:G.map((e=>(0,g.jsx)(b,{message:e,user:h,groupChat:null===le||void 0===le?void 0:le.isGroupChat},e._id))),M&&!(null!==le&&void 0!==le&&le.isGroupChat)&&(0,g.jsx)(E.L,{}),(null===le||void 0===le?void 0:le.isGroupChat)&&F&&(0,g.jsxs)("div",{style:{color:"green"},children:[F," is typing..."]}),(0,g.jsx)("div",{ref:J})]})}),(0,g.jsx)("form",{style:{position:"sticky",bottom:0,marginTop:"10px"},onSubmit:e=>{e.preventDefault(),v.trim()&&(X.emit(w.tq,{chatId:n,members:ee,message:v}),J.current.scrollIntoView({behaviour:"smooth"}),x(""),W.current.focus())},children:(0,g.jsxs)(o.A,{direction:"row",height:"100%",padding:"1rem",alignItems:"center",position:"relative",sx:{backgroundColor:d.ON,borderRadius:"15px"},children:[(0,g.jsx)(a.A,{sx:{position:"absolute",left:"1.5rem",rotate:"30deg",color:"black"},onClick:e=>{K((0,O.e5)(!0)),Z(e.currentTarget)},children:(0,g.jsx)(c.A,{})}),(0,g.jsx)(k.cl,{ref:W,placeholder:"Type Message Here...",value:v,onChange:e=>{x(e.target.value),z||(null!==le&&void 0!==le&&le.isGroupChat&&X.emit(w.o9,{userId:h._id,username:h.name,chatId:n}),N(!0)),X.emit(w.v_,{members:ee,chatId:n}),P.current&&clearTimeout(P.current),P.current=setTimeout((()=>{null!==le&&void 0!==le&&le.isGroupChat&&X.emit(w._b),X.emit(w.$H,{members:ee,chatId:n}),N(!1)}),1500)}}),(0,g.jsx)(a.A,{type:"submit",sx:{bgcolor:d.wm,rotate:"-30deg",color:ne,marginLeft:"1rem",padding:"0.5rem"},children:(0,g.jsx)(u.A,{})})]})}),(0,g.jsx)(Q,{anchorE1:H,chatId:n})]})}))}}]);
//# sourceMappingURL=49.21f7bb15.chunk.js.map